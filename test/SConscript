import os.path
from SConfig import *
Import('environment')

testSources = ['main.cpp','gmock-gtest-all.cc']

testEnvironment = environment.Clone(CCFLAGS = ['-std=c++0x', '-Werror', '-g', '-O0'])
libPath = '#' + os.path.join(BUILD_DIR, DEBUG_CONFIG)
test = testEnvironment.Program(target = TEST_TARGET, source = testSources, LIBS = ['pthread', LIB_TARGET],
LIBPATH = libPath, CPPPATH = ['#src', '#include', '.'])
testInstallPath = '#' + os.path.join(OUTPUT_DIR, TEST_CONFIG)
testEnvironment.Install(testInstallPath, test)

testRunPath = os.path.join(OUTPUT_DIR, TEST_CONFIG, TEST_TARGET)
if testEnvironment['PLATFORM'] != 'posix':
	testRunPath += '.exe'
	
testRun = testEnvironment.Command(target = 'testRun', source = testSources, action = testRunPath)
Depends( testRun, test )
AlwaysBuild(testRun)
